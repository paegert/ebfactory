<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ebf: src/mlp.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script src="http://www.mathjax.org/mathjax/MathJax.js">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ebf</div>
   <div id="projectbrief">EB Factory</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_703a5f36a5fc7abb67197856d62eb3e4.html">src</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>mlp.py</h1>  </div>
</div>
<div class="contents">
<a href="mlp_8py.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespacemlp.html">00001</a> <span class="comment">##</span>
<a name="l00002"></a>00002 <span class="comment"># </span>
<a name="l00003"></a>00003 <span class="comment"># @package  ebf</span>
<a name="l00004"></a>00004 <span class="comment"># @author   mpaegert</span>
<a name="l00005"></a>00005 <span class="comment"># @version  \$Revision: 1.1 $</span>
<a name="l00006"></a>00006 <span class="comment"># @date     \$Date: 2012/07/20 20:20:12 $</span>
<a name="l00007"></a>00007 <span class="comment"># </span>
<a name="l00008"></a>00008 <span class="comment"># A simple muulti-layer perceptron, currently restricted to one hidden layer</span>
<a name="l00009"></a>00009 <span class="comment"># </span>
<a name="l00010"></a>00010 <span class="comment"># @requires: numpy</span>
<a name="l00011"></a>00011 <span class="comment"># </span>
<a name="l00012"></a>00012 <span class="comment"># $Log: mlp_8py_source.html,v $
<a name="l00012"></a>00012 <span class="comment"># Revision 1.1  2012/07/20 20:20:12  paegerm
<a name="l00012"></a>00012 <span class="comment"># *** empty log message ***
<a name="l00012"></a>00012 <span class="comment">#</span>
<a name="l00013"></a>00013 <span class="comment"># Adding documentation, adding normalize option to evaluate(), adding stopval to</span>
<a name="l00014"></a>00014 <span class="comment"># earlystopping()</span>
<a name="l00015"></a>00015 <span class="comment"># Adding MlpError class</span>
<a name="l00016"></a>00016 <span class="comment"># </span>
<a name="l00017"></a>00017 <span class="comment"># Revision 1.1  2012/07/06 20:34:19  paegerm</span>
<a name="l00018"></a>00018 <span class="comment"># Initial revision</span>
<a name="l00019"></a>00019 <span class="comment"># </span>
<a name="l00020"></a>00020 <span class="comment"># </span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="keyword">from</span> numpy <span class="keyword">import</span> *
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="comment">##</span>
<a name="l00027"></a>00027 <span class="comment"># Exception class for mlp</span>
<a name="l00028"></a><a class="code" href="classmlp_1_1MlpError.html">00028</a> <span class="keyword">class </span><a class="code" href="classmlp_1_1MlpError.html" title="Exception class for mlp.">MlpError</a>(<a class="code" href="classException.html">Exception</a>):
<a name="l00029"></a>00029         <span class="comment">##</span>
<a name="l00030"></a>00030         <span class="comment"># </span>
<a name="l00031"></a>00031         <span class="comment">#               Constructor</span>
<a name="l00032"></a>00032         <span class="comment">#               </span>
<a name="l00033"></a>00033         <span class="comment">#               @param value: Exception value</span>
<a name="l00034"></a>00034         <span class="comment">#               </span>
<a name="l00035"></a><a class="code" href="classmlp_1_1MlpError.html#a2a09c605c9f8828db585739118e16f74">00035</a>         <span class="keyword">def </span><a class="code" href="classmlp_1_1MlpError.html#a7d524593f7cdd8e23b91eba473fa9b58" title="Constructor.">__init__</a>(self, value):
<a name="l00036"></a>00036                 self.<a class="code" href="classmlp_1_1MlpError.html#a2a09c605c9f8828db585739118e16f74">value</a> = value
<a name="l00037"></a>00037                 
<a name="l00038"></a>00038                 
<a name="l00039"></a><a class="code" href="classmlp_1_1MlpError.html#a660e2a1c32bf1ea08a1dcd0e123eb0be">00039</a>         <span class="keyword">def </span><a class="code" href="classmlp_1_1MlpError.html#a660e2a1c32bf1ea08a1dcd0e123eb0be">__str__</a>(self):
<a name="l00040"></a>00040                 <span class="keywordflow">return</span> repr(self.<a class="code" href="classmlp_1_1MlpError.html#a2a09c605c9f8828db585739118e16f74">value</a>)
<a name="l00041"></a>00041         
<a name="l00042"></a>00042         
<a name="l00043"></a>00043         
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="comment">##</span>
<a name="l00046"></a>00046 <span class="comment">#  A Multi-Layer Perceptron</span>
<a name="l00047"></a><a class="code" href="classmlp_1_1mlp.html">00047</a> <span class="keyword">class </span><a class="code" href="classmlp_1_1mlp.html" title="A Multi-Layer Perceptron.">mlp</a>(<a class="code" href="classobject.html">object</a>):
<a name="l00048"></a>00048 
<a name="l00049"></a>00049         <span class="comment">##</span>
<a name="l00050"></a>00050         <span class="comment">#  Constructor </span>
<a name="l00051"></a>00051         <span class="comment">#               </span>
<a name="l00052"></a>00052         <span class="comment">#               @param  inputs     Input values</span>
<a name="l00053"></a>00053         <span class="comment">#               @param  targets    Target values (known classification for example)</span>
<a name="l00054"></a>00054         <span class="comment">#               @param  nhidden    Number of neurons in hidden layer</span>
<a name="l00055"></a>00055         <span class="comment">#               @param  beta       Scaling parameter for activation function (1.0)</span>
<a name="l00056"></a>00056         <span class="comment">#               @param  momentum   Influence of previous learning step (0.9)</span>
<a name="l00057"></a>00057         <span class="comment">#               @param  outtype    &#39;linear&#39; or &#39;logistic&#39; (default) or &#39;softmax&#39;</span>
<a name="l00058"></a>00058         <span class="comment">#               @param  multires   True if multiple results are allowed</span>
<a name="l00059"></a>00059         <span class="comment">#               @param  mdelta     Maximum difference for a given class (0.01) </span>
<a name="l00060"></a>00060         <span class="comment">#               </span>
<a name="l00061"></a><a class="code" href="classmlp_1_1mlp.html#a07b85e2f033556b9ef42dbc9b05011c6">00061</a>         <span class="keyword">def </span><a class="code" href="classmlp_1_1mlp.html#a2bef8117288f389f454a7a96d044db73" title="Constructor.">__init__</a>(self, inputs, targets, nhidden, 
<a name="l00062"></a>00062                                   beta = 1, momentum = 0.9, outtype = <span class="stringliteral">&#39;logistic&#39;</span>,
<a name="l00063"></a>00063                                   multires = <span class="keyword">False</span>, mdelta = 0.01):
<a name="l00064"></a>00064                 
<a name="l00065"></a>00065                 seterr(all = <span class="stringliteral">&#39;raise&#39;</span>)
<a name="l00066"></a>00066                 <span class="comment"># Set up network size</span>
<a name="l00067"></a>00067                 self.<a class="code" href="classmlp_1_1mlp.html#a2769bdf0e5833e3999418868122feb28">nin</a> = shape(inputs)[1]
<a name="l00068"></a>00068                 self.<a class="code" href="classmlp_1_1mlp.html#a063008228bc8423626c2fa6e9a2664e9">nout</a> = shape(targets)[1]
<a name="l00069"></a>00069                 self.<a class="code" href="classmlp_1_1mlp.html#a463f6e1b39fb817f6a302e522e591516">ndata</a> = shape(inputs)[0]
<a name="l00070"></a>00070                 self.<a class="code" href="classmlp_1_1mlp.html#aa34217744fa9bc0bf1e8a3b358ed0c96">nhidden</a> = nhidden
<a name="l00071"></a>00071 
<a name="l00072"></a>00072                 self.<a class="code" href="classmlp_1_1mlp.html#a2f75a4b3429e0307568fc45d7e6950da">beta</a> = beta
<a name="l00073"></a>00073                 self.<a class="code" href="classmlp_1_1mlp.html#a3a4586ea27492667965ae101786a1fc8">momentum</a> = momentum
<a name="l00074"></a>00074                 self.<a class="code" href="classmlp_1_1mlp.html#a1b81b434ce0227f55d266dbb4c1e03a1">eta</a> = 0.1
<a name="l00075"></a>00075                 self.<a class="code" href="classmlp_1_1mlp.html#a79bb54ad6f2b84903e62c0b5f5eb7344">niterations</a> = -1
<a name="l00076"></a>00076                 self.<a class="code" href="classmlp_1_1mlp.html#ad85e6054d661877c130574e54434ce16">outtype</a> = outtype
<a name="l00077"></a>00077                 self.<a class="code" href="classmlp_1_1mlp.html#aa43f6dfd1707a355a974181d013e8f00">multires</a> = multires     <span class="comment"># true if multiple results allowed</span>
<a name="l00078"></a>00078                 self.<a class="code" href="classmlp_1_1mlp.html#a6a417dee0a55db5f56349db1249a3ec9">mdelta</a>   = mdelta       <span class="comment"># allowed difference for multiple results</span>
<a name="l00079"></a>00079 
<a name="l00080"></a>00080                 self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a> = <span class="keywordtype">None</span>
<a name="l00081"></a>00081                 self.<a class="code" href="classmlp_1_1mlp.html#a93598c8f15a234b94c33a853527bec31">traintstats</a> = <span class="keywordtype">None</span>
<a name="l00082"></a>00082                 self.<a class="code" href="classmlp_1_1mlp.html#a6ede6eef42e61e87fd2e79cf61529688">validstats</a>  = <span class="keywordtype">None</span>
<a name="l00083"></a>00083                 self.<a class="code" href="classmlp_1_1mlp.html#a60e5b36a360073418d45d221ff5c47f2">teststats</a>   = <span class="keywordtype">None</span>
<a name="l00084"></a>00084                 self.<a class="code" href="classmlp_1_1mlp.html#a4e81b494e111fb2c72000efbaa647963">trainerror</a> = -1.0
<a name="l00085"></a>00085                 self.<a class="code" href="classmlp_1_1mlp.html#a778e5d4e1b507b330dcb6804455ac416">validerror</a> = -1.0
<a name="l00086"></a>00086                 self.<a class="code" href="classmlp_1_1mlp.html#aa9d78571a75937654b1dbb2c78960aa1">stopcount</a>  = -1
<a name="l00087"></a>00087                 self.<a class="code" href="classmlp_1_1mlp.html#aab9e6c1e9b3661fa3f276d09baf27144">allpercent</a> = 0.0
<a name="l00088"></a>00088                 self.<a class="code" href="classmlp_1_1mlp.html#a21e9d80982176c49feb06586010fa686">debug</a>      = 0
<a name="l00089"></a>00089                 self.<a class="code" href="classmlp_1_1mlp.html#ad29044bad5109b92f57149d8bec68e14">subdir</a>     = <span class="stringliteral">&#39;./&#39;</span>
<a name="l00090"></a>00090                 self.<a class="code" href="classmlp_1_1mlp.html#a07b85e2f033556b9ef42dbc9b05011c6">writeweights</a> = <span class="keyword">False</span>
<a name="l00091"></a>00091                 
<a name="l00092"></a>00092                 self.<a class="code" href="classmlp_1_1mlp.html#a9f1194a28bf6345709b62f34ef41a8f5">normsubtract</a> = <span class="keywordtype">None</span>
<a name="l00093"></a>00093                 self.<a class="code" href="classmlp_1_1mlp.html#a667ab65d926bd62ef896add5f059ce06">normdevide</a>   = <span class="keywordtype">None</span>
<a name="l00094"></a>00094                 self.<a class="code" href="classmlp_1_1mlp.html#ae97e72b20c044203c2a86adc234eb9c5">classes</a>      = <span class="keywordtype">None</span>
<a name="l00095"></a>00095 
<a name="l00096"></a>00096                 <span class="comment"># Initialise network</span>
<a name="l00097"></a>00097                 self.<a class="code" href="classmlp_1_1mlp.html#af03c95450f5cae7754975376c0b80a66">weights1</a> = ((random.rand(self.<a class="code" href="classmlp_1_1mlp.html#a2769bdf0e5833e3999418868122feb28">nin</a> + 1, self.<a class="code" href="classmlp_1_1mlp.html#aa34217744fa9bc0bf1e8a3b358ed0c96">nhidden</a>) - 0.5) * 2 / 
<a name="l00098"></a>00098                                                  sqrt(self.<a class="code" href="classmlp_1_1mlp.html#a2769bdf0e5833e3999418868122feb28">nin</a>))
<a name="l00099"></a>00099                 self.<a class="code" href="classmlp_1_1mlp.html#aab855561bd19a52513ee8b2c84facaba">weights2</a> = ((random.rand(self.<a class="code" href="classmlp_1_1mlp.html#aa34217744fa9bc0bf1e8a3b358ed0c96">nhidden</a> + 1, self.<a class="code" href="classmlp_1_1mlp.html#a063008228bc8423626c2fa6e9a2664e9">nout</a>) - 0.5) * 2 / 
<a name="l00100"></a>00100                                                  sqrt(self.<a class="code" href="classmlp_1_1mlp.html#aa34217744fa9bc0bf1e8a3b358ed0c96">nhidden</a>))
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 
<a name="l00104"></a>00104         <span class="comment">##</span>
<a name="l00105"></a>00105         <span class="comment"># </span>
<a name="l00106"></a>00106         <span class="comment">#               Set normalization vectors for input values:</span>
<a name="l00107"></a>00107         <span class="comment">#                   normalizedvalue = (value - subtract) / devide</span>
<a name="l00108"></a>00108         <span class="comment">#               Usually subtract is the mean value, devide the standard deviation</span>
<a name="l00109"></a>00109         <span class="comment">#               </span>
<a name="l00110"></a>00110         <span class="comment">#               @param  subtract    Vector of values to subtract from each input column</span>
<a name="l00111"></a>00111         <span class="comment">#               @param  devide      Vector of values to devide difference by</span>
<a name="l00112"></a>00112         <span class="comment">#               </span>
<a name="l00113"></a><a class="code" href="classmlp_1_1mlp.html#a9e27c383a6bb840545bad2b0b6c18cfd">00113</a>         <span class="keyword">def </span><a class="code" href="classmlp_1_1mlp.html#a9e27c383a6bb840545bad2b0b6c18cfd" title="Set normalization vectors for input values: normalizedvalue = (value - subtract) / devide Usually sub...">setnormvalues</a>(self, subtract, devide):
<a name="l00114"></a>00114                 self.<a class="code" href="classmlp_1_1mlp.html#a9f1194a28bf6345709b62f34ef41a8f5">normsubtract</a> = subtract
<a name="l00115"></a>00115                 self.<a class="code" href="classmlp_1_1mlp.html#a667ab65d926bd62ef896add5f059ce06">normdevide</a>   = devide
<a name="l00116"></a>00116         
<a name="l00117"></a>00117         
<a name="l00118"></a>00118         
<a name="l00119"></a>00119         <span class="comment">##</span>
<a name="l00120"></a>00120         <span class="comment"># </span>
<a name="l00121"></a>00121         <span class="comment">#               Return normalization vectors</span>
<a name="l00122"></a>00122         <span class="comment">#               </span>
<a name="l00123"></a>00123         <span class="comment">#               @return (normsubtract, normdevide)</span>
<a name="l00124"></a>00124         <span class="comment">#               </span>
<a name="l00125"></a><a class="code" href="classmlp_1_1mlp.html#a3fadca9214b0ef2eb801f820cbe34196">00125</a>         <span class="keyword">def </span><a class="code" href="classmlp_1_1mlp.html#a3fadca9214b0ef2eb801f820cbe34196" title="Return normalization vectors.">getnormvalues</a>(self):
<a name="l00126"></a>00126                 <span class="keywordflow">return</span> (self.<a class="code" href="classmlp_1_1mlp.html#a9f1194a28bf6345709b62f34ef41a8f5">normsubtract</a>, self.<a class="code" href="classmlp_1_1mlp.html#a667ab65d926bd62ef896add5f059ce06">normdevide</a>)
<a name="l00127"></a>00127 
<a name="l00128"></a>00128 
<a name="l00129"></a>00129 
<a name="l00130"></a>00130         <span class="comment">##</span>
<a name="l00131"></a>00131         <span class="comment"># </span>
<a name="l00132"></a>00132         <span class="comment">#               Set vector of classes</span>
<a name="l00133"></a>00133         <span class="comment">#               </span>
<a name="l00134"></a>00134         <span class="comment">#               @param  classes    String vector of classes to train on</span>
<a name="l00135"></a>00135         <span class="comment">#               </span>
<a name="l00136"></a><a class="code" href="classmlp_1_1mlp.html#a8411b7d198a35a86ef134f6f7ed7045f">00136</a>         <span class="keyword">def </span><a class="code" href="classmlp_1_1mlp.html#a8411b7d198a35a86ef134f6f7ed7045f" title="Set vector of classes.">setclasses</a>(self, classes):
<a name="l00137"></a>00137                 self.<a class="code" href="classmlp_1_1mlp.html#ae97e72b20c044203c2a86adc234eb9c5">classes</a> = classes
<a name="l00138"></a>00138         
<a name="l00139"></a>00139         
<a name="l00140"></a>00140         
<a name="l00141"></a>00141         <span class="comment">##</span>
<a name="l00142"></a>00142         <span class="comment"># Return classes network has been trained on</span>
<a name="l00143"></a><a class="code" href="classmlp_1_1mlp.html#af3f30cb683a757eb4e9286ec48817dc4">00143</a>         <span class="keyword">def </span><a class="code" href="classmlp_1_1mlp.html#af3f30cb683a757eb4e9286ec48817dc4" title="Return classes network has been trained on.">getclasses</a>(self):
<a name="l00144"></a>00144                 <span class="keywordflow">return</span> self.<a class="code" href="classmlp_1_1mlp.html#ae97e72b20c044203c2a86adc234eb9c5">classes</a>
<a name="l00145"></a>00145         
<a name="l00146"></a>00146 
<a name="l00147"></a>00147 
<a name="l00148"></a>00148         <span class="comment">##</span>
<a name="l00149"></a>00149         <span class="comment"># </span>
<a name="l00150"></a>00150         <span class="comment">#               Train network with validation set, stop if nothing else can be learned.</span>
<a name="l00151"></a>00151         <span class="comment">#               Learning stops if the validation error does falls below a limit.</span>
<a name="l00152"></a>00152         <span class="comment">#               </span>
<a name="l00153"></a>00153         <span class="comment">#               @param  inputs         Input values</span>
<a name="l00154"></a>00154         <span class="comment">#               @param  targets        Target values (known classification for example)</span>
<a name="l00155"></a>00155         <span class="comment">#               @param  valid          Validation set</span>
<a name="l00156"></a>00156         <span class="comment">#               @param  validtargets   Target values for validation set</span>
<a name="l00157"></a>00157         <span class="comment">#               @param  eta            Learning rate</span>
<a name="l00158"></a>00158         <span class="comment">#               @param  niterations    Number of iterations before shuffling </span>
<a name="l00159"></a>00159         <span class="comment">#               @param  stopval        stop at this value of validation error</span>
<a name="l00160"></a>00160         <span class="comment">#               @param  makestats      True if statistics for report are generated (True)</span>
<a name="l00161"></a>00161         <span class="comment">#               </span>
<a name="l00162"></a>00162         <span class="comment">#               @return   (validationerror, trainingerror)</span>
<a name="l00163"></a>00163         <span class="comment">#               </span>
<a name="l00164"></a><a class="code" href="classmlp_1_1mlp.html#adf2a63cd452121ea5e135c191dc5723d">00164</a>         <span class="keyword">def </span><a class="code" href="classmlp_1_1mlp.html#a5a681e9f1fe0aa039aa75dfb99f69f8c" title="Train network with validation set, stop if nothing else can be learned.">earlystopping</a>(self, inputs, targets, valid, validtargets, eta, 
<a name="l00165"></a>00165                                           niterations = 100, stopval = 0.001, makestats = <span class="keyword">True</span>):
<a name="l00166"></a>00166 
<a name="l00167"></a>00167                 <span class="comment"># add the bias nodes</span>
<a name="l00168"></a>00168                 valid = concatenate((valid, -ones((shape(valid)[0], 1))), axis = 1)
<a name="l00169"></a>00169                 
<a name="l00170"></a>00170                 self.<a class="code" href="classmlp_1_1mlp.html#a1b81b434ce0227f55d266dbb4c1e03a1">eta</a> = eta
<a name="l00171"></a>00171                 self.<a class="code" href="classmlp_1_1mlp.html#adf2a63cd452121ea5e135c191dc5723d">trainstats</a> = <span class="keywordtype">None</span>
<a name="l00172"></a>00172                 self.<a class="code" href="classmlp_1_1mlp.html#a6ede6eef42e61e87fd2e79cf61529688">validstats</a> = <span class="keywordtype">None</span>
<a name="l00173"></a>00173                 <span class="keywordflow">if</span> (makestats == <span class="keyword">True</span>):
<a name="l00174"></a>00174                         self.<a class="code" href="classmlp_1_1mlp.html#adf2a63cd452121ea5e135c191dc5723d">trainstats</a> = targets.sum(axis = 0)
<a name="l00175"></a>00175                         self.<a class="code" href="classmlp_1_1mlp.html#a6ede6eef42e61e87fd2e79cf61529688">validstats</a> = validtargets.sum(axis = 0)
<a name="l00176"></a>00176 
<a name="l00177"></a>00177                 old_val_error1 = 100002
<a name="l00178"></a>00178                 old_val_error2 = 100001
<a name="l00179"></a>00179                 self.<a class="code" href="classmlp_1_1mlp.html#a778e5d4e1b507b330dcb6804455ac416">validerror</a>  = 100000
<a name="l00180"></a>00180 
<a name="l00181"></a>00181                 self.<a class="code" href="classmlp_1_1mlp.html#aa9d78571a75937654b1dbb2c78960aa1">stopcount</a> = 0
<a name="l00182"></a>00182                 <span class="keywordflow">if</span> ((self.<a class="code" href="classmlp_1_1mlp.html#a07b85e2f033556b9ef42dbc9b05011c6">writeweights</a> == <span class="keyword">True</span>) <span class="keywordflow">or</span> (self.<a class="code" href="classmlp_1_1mlp.html#a21e9d80982176c49feb06586010fa686">debug</a> &gt; 0)):
<a name="l00183"></a>00183                         fnhidden = <span class="stringliteral">&#39;%s/hidden%d&#39;</span> % (self.<a class="code" href="classmlp_1_1mlp.html#ad29044bad5109b92f57149d8bec68e14">subdir</a>, self.<a class="code" href="classmlp_1_1mlp.html#aa9d78571a75937654b1dbb2c78960aa1">stopcount</a>)
<a name="l00184"></a>00184                         fnoutput = <span class="stringliteral">&#39;%s/output%d&#39;</span> % (self.<a class="code" href="classmlp_1_1mlp.html#ad29044bad5109b92f57149d8bec68e14">subdir</a>, self.<a class="code" href="classmlp_1_1mlp.html#aa9d78571a75937654b1dbb2c78960aa1">stopcount</a>)
<a name="l00185"></a>00185                         savetxt(fnhidden, self.<a class="code" href="classmlp_1_1mlp.html#af03c95450f5cae7754975376c0b80a66">weights1</a>, <span class="stringliteral">&#39;%8.4f&#39;</span>)
<a name="l00186"></a>00186                         savetxt(fnoutput, self.<a class="code" href="classmlp_1_1mlp.html#aab855561bd19a52513ee8b2c84facaba">weights2</a>, <span class="stringliteral">&#39;%8.4f&#39;</span>)
<a name="l00187"></a>00187                         
<a name="l00188"></a>00188                 <span class="keywordflow">while</span> (((old_val_error1 - self.<a class="code" href="classmlp_1_1mlp.html#a778e5d4e1b507b330dcb6804455ac416">validerror</a>) &gt; stopval) <span class="keywordflow">or</span> 
<a name="l00189"></a>00189                            ((old_val_error2 - old_val_error1) &gt; stopval)):
<a name="l00190"></a>00190                         self.<a class="code" href="classmlp_1_1mlp.html#aa9d78571a75937654b1dbb2c78960aa1">stopcount</a> += 1
<a name="l00191"></a>00191                         self.<a class="code" href="classmlp_1_1mlp.html#a4e81b494e111fb2c72000efbaa647963">trainerror</a> = self.<a class="code" href="classmlp_1_1mlp.html#a494984c787706714539fe8f1d78efa30" title="Train the network without validation set.">mlptrain</a>(inputs, targets, eta, niterations)
<a name="l00192"></a>00192                         old_val_error2 = old_val_error1
<a name="l00193"></a>00193                         old_val_error1 = self.<a class="code" href="classmlp_1_1mlp.html#a778e5d4e1b507b330dcb6804455ac416">validerror</a>
<a name="l00194"></a>00194                         validout = self.<a class="code" href="classmlp_1_1mlp.html#a50fab3d7313376cf2de90bcfc80db3a5" title="Run the network forward (internal function)">_mlpfwd</a>(valid)
<a name="l00195"></a>00195                         self.<a class="code" href="classmlp_1_1mlp.html#a778e5d4e1b507b330dcb6804455ac416">validerror</a> = 0.5 * sum((validtargets - validout) ** 2)
<a name="l00196"></a>00196                         <span class="keywordflow">if</span> (self.<a class="code" href="classmlp_1_1mlp.html#a21e9d80982176c49feb06586010fa686">debug</a> &gt; 0):
<a name="l00197"></a>00197                                 fmt = <span class="stringliteral">&#39;%3d  trainerr = %7.3f  validerr = %7.3f, &#39;</span> + \
<a name="l00198"></a>00198                                       <span class="stringliteral">&#39;dold = %8.4f, dnew = %8.4f&#39;</span>
<a name="l00199"></a>00199                                 <span class="keywordflow">print</span>  fmt % (self.<a class="code" href="classmlp_1_1mlp.html#aa9d78571a75937654b1dbb2c78960aa1">stopcount</a>, self.<a class="code" href="classmlp_1_1mlp.html#a4e81b494e111fb2c72000efbaa647963">trainerror</a>, self.<a class="code" href="classmlp_1_1mlp.html#a778e5d4e1b507b330dcb6804455ac416">validerror</a>,
<a name="l00200"></a>00200                                                           old_val_error2 - old_val_error1,
<a name="l00201"></a>00201                                                           old_val_error1 - self.<a class="code" href="classmlp_1_1mlp.html#a778e5d4e1b507b330dcb6804455ac416">validerror</a>)
<a name="l00202"></a>00202 
<a name="l00203"></a>00203                 <span class="keywordflow">if</span> ((self.<a class="code" href="classmlp_1_1mlp.html#a07b85e2f033556b9ef42dbc9b05011c6">writeweights</a> == <span class="keyword">True</span>) <span class="keywordflow">or</span> (self.<a class="code" href="classmlp_1_1mlp.html#a21e9d80982176c49feb06586010fa686">debug</a> &gt; 0)):
<a name="l00204"></a>00204                         fnhidden = <span class="stringliteral">&#39;%s/hidden%d&#39;</span> % (self.<a class="code" href="classmlp_1_1mlp.html#ad29044bad5109b92f57149d8bec68e14">subdir</a>, self.<a class="code" href="classmlp_1_1mlp.html#aa9d78571a75937654b1dbb2c78960aa1">stopcount</a>)
<a name="l00205"></a>00205                         fnoutput = <span class="stringliteral">&#39;%s/output%d&#39;</span> % (self.<a class="code" href="classmlp_1_1mlp.html#ad29044bad5109b92f57149d8bec68e14">subdir</a>, self.<a class="code" href="classmlp_1_1mlp.html#aa9d78571a75937654b1dbb2c78960aa1">stopcount</a>)
<a name="l00206"></a>00206                         savetxt(fnhidden, self.<a class="code" href="classmlp_1_1mlp.html#af03c95450f5cae7754975376c0b80a66">weights1</a>, <span class="stringliteral">&#39;%8.4f&#39;</span>)
<a name="l00207"></a>00207                         savetxt(fnoutput, self.<a class="code" href="classmlp_1_1mlp.html#aab855561bd19a52513ee8b2c84facaba">weights2</a>, <span class="stringliteral">&#39;%8.4f&#39;</span>)
<a name="l00208"></a>00208 
<a name="l00209"></a>00209                 <span class="keywordflow">return</span> (self.<a class="code" href="classmlp_1_1mlp.html#a778e5d4e1b507b330dcb6804455ac416">validerror</a>, self.<a class="code" href="classmlp_1_1mlp.html#a4e81b494e111fb2c72000efbaa647963">trainerror</a>)
<a name="l00210"></a>00210 
<a name="l00211"></a>00211 
<a name="l00212"></a>00212 
<a name="l00213"></a>00213         <span class="comment">##</span>
<a name="l00214"></a>00214         <span class="comment">#  </span>
<a name="l00215"></a>00215         <span class="comment">#               Train the network without validation set </span>
<a name="l00216"></a>00216         <span class="comment"># </span>
<a name="l00217"></a>00217         <span class="comment">#               @param    inputs         Input values</span>
<a name="l00218"></a>00218         <span class="comment">#               @param    targets        Target values (known classification for example)</span>
<a name="l00219"></a>00219         <span class="comment">#               @param    eta            Learning rate</span>
<a name="l00220"></a>00220         <span class="comment">#               @param    niterations    Number of iterations</span>
<a name="l00221"></a>00221         <span class="comment">#               </span>
<a name="l00222"></a>00222         <span class="comment">#               @return   error</span>
<a name="l00223"></a>00223         <span class="comment">#               </span>
<a name="l00224"></a><a class="code" href="classmlp_1_1mlp.html#ad6d42a5405728d749f144b938b323ce1">00224</a>         <span class="keyword">def </span><a class="code" href="classmlp_1_1mlp.html#a494984c787706714539fe8f1d78efa30" title="Train the network without validation set.">mlptrain</a>(self, inputs, targets, eta, niterations):
<a name="l00225"></a>00225                 <span class="comment"># Add the inputs that match the bias node</span>
<a name="l00226"></a>00226                 inputs = concatenate((inputs, -ones((self.<a class="code" href="classmlp_1_1mlp.html#a463f6e1b39fb817f6a302e522e591516">ndata</a>, 1))), axis = 1)
<a name="l00227"></a>00227                 change = range(self.<a class="code" href="classmlp_1_1mlp.html#a463f6e1b39fb817f6a302e522e591516">ndata</a>)
<a name="l00228"></a>00228 
<a name="l00229"></a>00229                 updatew1 = zeros((shape(self.<a class="code" href="classmlp_1_1mlp.html#af03c95450f5cae7754975376c0b80a66">weights1</a>)))
<a name="l00230"></a>00230                 updatew2 = zeros((shape(self.<a class="code" href="classmlp_1_1mlp.html#aab855561bd19a52513ee8b2c84facaba">weights2</a>)))
<a name="l00231"></a>00231 
<a name="l00232"></a>00232                 error = -1.0
<a name="l00233"></a>00233                 self.<a class="code" href="classmlp_1_1mlp.html#a79bb54ad6f2b84903e62c0b5f5eb7344">niterations</a> = niterations
<a name="l00234"></a>00234                 seterr(under = <span class="stringliteral">&#39;ignore&#39;</span>)
<a name="l00235"></a>00235                 <span class="keywordflow">for</span> n <span class="keywordflow">in</span> xrange(niterations):
<a name="l00236"></a>00236 
<a name="l00237"></a>00237                         self.<a class="code" href="classmlp_1_1mlp.html#ad6d42a5405728d749f144b938b323ce1">outputs</a> = self.<a class="code" href="classmlp_1_1mlp.html#a50fab3d7313376cf2de90bcfc80db3a5" title="Run the network forward (internal function)">_mlpfwd</a>(inputs)
<a name="l00238"></a>00238 
<a name="l00239"></a>00239                         error = 0.5 * sum((targets - self.<a class="code" href="classmlp_1_1mlp.html#ad6d42a5405728d749f144b938b323ce1">outputs</a>) ** 2)
<a name="l00240"></a>00240 <span class="comment">#                       if (mod(n, 100) == 0):</span>
<a name="l00241"></a>00241 <span class="comment">#                               print &quot;Iteration: &quot;, n, &quot; Error: &quot;, error</span>
<a name="l00242"></a>00242 
<a name="l00243"></a>00243                         <span class="comment"># Different types of output neurons</span>
<a name="l00244"></a>00244                         <span class="keywordflow">if</span> self.<a class="code" href="classmlp_1_1mlp.html#ad85e6054d661877c130574e54434ce16">outtype</a> == <span class="stringliteral">&#39;linear&#39;</span>:
<a name="l00245"></a>00245                                 deltao = (targets - self.<a class="code" href="classmlp_1_1mlp.html#ad6d42a5405728d749f144b938b323ce1">outputs</a>) / self.<a class="code" href="classmlp_1_1mlp.html#a463f6e1b39fb817f6a302e522e591516">ndata</a>
<a name="l00246"></a>00246                         <span class="keywordflow">elif</span> self.<a class="code" href="classmlp_1_1mlp.html#ad85e6054d661877c130574e54434ce16">outtype</a> == <span class="stringliteral">&#39;logistic&#39;</span>:
<a name="l00247"></a>00247                                 deltao = (targets - self.<a class="code" href="classmlp_1_1mlp.html#ad6d42a5405728d749f144b938b323ce1">outputs</a>) * \
<a name="l00248"></a>00248                                          self.<a class="code" href="classmlp_1_1mlp.html#ad6d42a5405728d749f144b938b323ce1">outputs</a> * (1.0 - self.<a class="code" href="classmlp_1_1mlp.html#ad6d42a5405728d749f144b938b323ce1">outputs</a>)
<a name="l00249"></a>00249                         <span class="keywordflow">elif</span> self.<a class="code" href="classmlp_1_1mlp.html#ad85e6054d661877c130574e54434ce16">outtype</a> == <span class="stringliteral">&#39;softmax&#39;</span>:
<a name="l00250"></a>00250                                 <span class="comment">#deltao = (targets - self.outputs) * self.outputs / self.ndata</span>
<a name="l00251"></a>00251                                 deltao = (targets - self.<a class="code" href="classmlp_1_1mlp.html#ad6d42a5405728d749f144b938b323ce1">outputs</a>) / self.<a class="code" href="classmlp_1_1mlp.html#a463f6e1b39fb817f6a302e522e591516">ndata</a>
<a name="l00252"></a>00252                         <span class="keywordflow">else</span>:
<a name="l00253"></a>00253                                 <span class="keywordflow">print</span> <span class="stringliteral">&quot;Error: illegal outtype&quot;</span>
<a name="l00254"></a>00254 
<a name="l00255"></a>00255                         deltah = self.<a class="code" href="classmlp_1_1mlp.html#a4988ae34b275886fce8a1d4c6a167529">hidden</a> * (1.0 - self.<a class="code" href="classmlp_1_1mlp.html#a4988ae34b275886fce8a1d4c6a167529">hidden</a>) * \
<a name="l00256"></a>00256                                  (dot(deltao, transpose(self.<a class="code" href="classmlp_1_1mlp.html#aab855561bd19a52513ee8b2c84facaba">weights2</a>)))
<a name="l00257"></a>00257 
<a name="l00258"></a>00258                         updatew1 = eta * (dot(transpose(inputs), deltah[:, :-1])) + \
<a name="l00259"></a>00259                                    self.<a class="code" href="classmlp_1_1mlp.html#a3a4586ea27492667965ae101786a1fc8">momentum</a> * updatew1
<a name="l00260"></a>00260                         updatew2 = eta * (dot(transpose(self.<a class="code" href="classmlp_1_1mlp.html#a4988ae34b275886fce8a1d4c6a167529">hidden</a>), deltao)) + \
<a name="l00261"></a>00261                                    self.<a class="code" href="classmlp_1_1mlp.html#a3a4586ea27492667965ae101786a1fc8">momentum</a> * updatew2
<a name="l00262"></a>00262                         self.<a class="code" href="classmlp_1_1mlp.html#af03c95450f5cae7754975376c0b80a66">weights1</a> += updatew1
<a name="l00263"></a>00263                         self.<a class="code" href="classmlp_1_1mlp.html#aab855561bd19a52513ee8b2c84facaba">weights2</a> += updatew2
<a name="l00264"></a>00264 
<a name="l00265"></a>00265                         <span class="comment"># Randomise order of inputs</span>
<a name="l00266"></a>00266                         random.shuffle(change)
<a name="l00267"></a>00267                         inputs = inputs[change, :]
<a name="l00268"></a>00268                         targets = targets[change, :]
<a name="l00269"></a>00269                 
<a name="l00270"></a>00270                 <span class="keywordflow">return</span> error
<a name="l00271"></a>00271 
<a name="l00272"></a>00272 
<a name="l00273"></a>00273 
<a name="l00274"></a>00274         <span class="comment">##</span>
<a name="l00275"></a>00275         <span class="comment">#  </span>
<a name="l00276"></a>00276         <span class="comment">#               Run the network forward (internal function)</span>
<a name="l00277"></a>00277         <span class="comment">#               </span>
<a name="l00278"></a>00278         <span class="comment">#               @param    inputs    Input values</span>
<a name="l00279"></a>00279         <span class="comment">#               </span>
<a name="l00280"></a>00280         <span class="comment">#               @return   output    Values of output layer  </span>
<a name="l00281"></a>00281         <span class="comment">#               </span>
<a name="l00282"></a><a class="code" href="classmlp_1_1mlp.html#a4988ae34b275886fce8a1d4c6a167529">00282</a>         <span class="keyword">def </span><a class="code" href="classmlp_1_1mlp.html#a50fab3d7313376cf2de90bcfc80db3a5" title="Run the network forward (internal function)">_mlpfwd</a>(self, inputs):
<a name="l00283"></a>00283 
<a name="l00284"></a>00284                 self.<a class="code" href="classmlp_1_1mlp.html#a4988ae34b275886fce8a1d4c6a167529">hidden</a> = dot(inputs, self.<a class="code" href="classmlp_1_1mlp.html#af03c95450f5cae7754975376c0b80a66">weights1</a>);
<a name="l00285"></a>00285                 <span class="keywordflow">try</span>:
<a name="l00286"></a>00286                         self.<a class="code" href="classmlp_1_1mlp.html#a4988ae34b275886fce8a1d4c6a167529">hidden</a> = 1.0 / (1.0 + exp(-self.<a class="code" href="classmlp_1_1mlp.html#a2f75a4b3429e0307568fc45d7e6950da">beta</a> * self.<a class="code" href="classmlp_1_1mlp.html#a4988ae34b275886fce8a1d4c6a167529">hidden</a>))
<a name="l00287"></a>00287                 <span class="keywordflow">except</span> FloatingPointError <span class="keyword">as</span> err:
<a name="l00288"></a>00288                         <span class="keywordflow">print</span> <span class="stringliteral">&#39;hidden shape = &#39;</span>, self.<a class="code" href="classmlp_1_1mlp.html#a4988ae34b275886fce8a1d4c6a167529">hidden</a>.shape
<a name="l00289"></a>00289                         maxpos = unravel_index(self.<a class="code" href="classmlp_1_1mlp.html#a4988ae34b275886fce8a1d4c6a167529">hidden</a>.argmax(), self.<a class="code" href="classmlp_1_1mlp.html#a4988ae34b275886fce8a1d4c6a167529">hidden</a>.shape)
<a name="l00290"></a>00290                         minpos = unravel_index(self.<a class="code" href="classmlp_1_1mlp.html#a4988ae34b275886fce8a1d4c6a167529">hidden</a>.argmin(), self.<a class="code" href="classmlp_1_1mlp.html#a4988ae34b275886fce8a1d4c6a167529">hidden</a>.shape)  
<a name="l00291"></a>00291                         <span class="keywordflow">print</span> <span class="stringliteral">&#39;hidden max = &#39;</span>, self.<a class="code" href="classmlp_1_1mlp.html#a4988ae34b275886fce8a1d4c6a167529">hidden</a>.max(), <span class="stringliteral">&#39;at&#39;</span>, maxpos
<a name="l00292"></a>00292                         <span class="keywordflow">print</span> <span class="stringliteral">&#39;hidden min = &#39;</span>, self.<a class="code" href="classmlp_1_1mlp.html#a4988ae34b275886fce8a1d4c6a167529">hidden</a>.min(), <span class="stringliteral">&#39;at&#39;</span>, minpos
<a name="l00293"></a>00293                         <span class="keywordflow">raise</span> MlpError(minpos[0])
<a name="l00294"></a>00294                 self.<a class="code" href="classmlp_1_1mlp.html#a4988ae34b275886fce8a1d4c6a167529">hidden</a> = concatenate((self.<a class="code" href="classmlp_1_1mlp.html#a4988ae34b275886fce8a1d4c6a167529">hidden</a>, -ones((shape(inputs)[0], 1))), 
<a name="l00295"></a>00295                                                                   axis = 1)
<a name="l00296"></a>00296 
<a name="l00297"></a>00297                 outputs = dot(self.<a class="code" href="classmlp_1_1mlp.html#a4988ae34b275886fce8a1d4c6a167529">hidden</a>, self.<a class="code" href="classmlp_1_1mlp.html#aab855561bd19a52513ee8b2c84facaba">weights2</a>);
<a name="l00298"></a>00298 
<a name="l00299"></a>00299                 <span class="comment"># Different types of output neurons</span>
<a name="l00300"></a>00300                 <span class="keywordflow">if</span> self.<a class="code" href="classmlp_1_1mlp.html#ad85e6054d661877c130574e54434ce16">outtype</a> == <span class="stringliteral">&#39;linear&#39;</span>:
<a name="l00301"></a>00301                         <span class="keywordflow">return</span> outputs
<a name="l00302"></a>00302                 <span class="keywordflow">elif</span> self.<a class="code" href="classmlp_1_1mlp.html#ad85e6054d661877c130574e54434ce16">outtype</a> == <span class="stringliteral">&#39;logistic&#39;</span>:
<a name="l00303"></a>00303                         <span class="keywordflow">try</span>:
<a name="l00304"></a>00304                                 res = 1.0 / (1.0 + exp(-self.<a class="code" href="classmlp_1_1mlp.html#a2f75a4b3429e0307568fc45d7e6950da">beta</a> * outputs))
<a name="l00305"></a>00305                         <span class="keywordflow">except</span> FloatingPointError <span class="keyword">as</span> err:
<a name="l00306"></a>00306                                 <span class="keywordflow">print</span> outputs
<a name="l00307"></a>00307                         <span class="keywordflow">return</span> res
<a name="l00308"></a>00308                 <span class="keywordflow">elif</span> self.<a class="code" href="classmlp_1_1mlp.html#ad85e6054d661877c130574e54434ce16">outtype</a> == <span class="stringliteral">&#39;softmax&#39;</span>:
<a name="l00309"></a>00309                         normalisers = sum(exp(outputs), axis = 1) * \
<a name="l00310"></a>00310                                           ones((1, shape(outputs)[0]))
<a name="l00311"></a>00311                         <span class="keywordflow">return</span> transpose(transpose(exp(outputs)) / normalisers)
<a name="l00312"></a>00312                 <span class="keywordflow">else</span>:
<a name="l00313"></a>00313                         <span class="keywordflow">print</span> <span class="stringliteral">&quot;error: illegal outtype&quot;</span>
<a name="l00314"></a>00314 
<a name="l00315"></a>00315 
<a name="l00316"></a>00316 
<a name="l00317"></a>00317         <span class="comment">##</span>
<a name="l00318"></a>00318         <span class="comment"># </span>
<a name="l00319"></a>00319         <span class="comment">#               Evaluate input values</span>
<a name="l00320"></a>00320         <span class="comment">#               </span>
<a name="l00321"></a>00321         <span class="comment">#               @param    inputs    Input values</span>
<a name="l00322"></a>00322         <span class="comment">#               @param    normalize True (default) if inputs should be normalized</span>
<a name="l00323"></a>00323         <span class="comment">#               </span>
<a name="l00324"></a>00324         <span class="comment">#               @return   outputs   Values of output layer  </span>
<a name="l00325"></a>00325         <span class="comment">#               </span>
<a name="l00326"></a><a class="code" href="classmlp_1_1mlp.html#af0925b47c421fbaeaa96dc90b0f9b6d5">00326</a>         <span class="keyword">def </span><a class="code" href="classmlp_1_1mlp.html#af0925b47c421fbaeaa96dc90b0f9b6d5" title="Evaluate input values.">evaluate</a>(self, inputs, normalize = True):
<a name="l00327"></a>00327                 
<a name="l00328"></a>00328                 <span class="comment"># normalize inputs</span>
<a name="l00329"></a>00329                 <span class="keywordflow">if</span> ((normalize == <span class="keyword">True</span>) <span class="keywordflow">and</span> 
<a name="l00330"></a>00330                         (self.<a class="code" href="classmlp_1_1mlp.html#a9f1194a28bf6345709b62f34ef41a8f5">normsubtract</a> != <span class="keywordtype">None</span>) <span class="keywordflow">and</span> (self.<a class="code" href="classmlp_1_1mlp.html#a667ab65d926bd62ef896add5f059ce06">normdevide</a> != <span class="keywordtype">None</span>)):
<a name="l00331"></a>00331                         inputs = (inputs - self.<a class="code" href="classmlp_1_1mlp.html#a9f1194a28bf6345709b62f34ef41a8f5">normsubtract</a>) / self.<a class="code" href="classmlp_1_1mlp.html#a667ab65d926bd62ef896add5f059ce06">normdevide</a>
<a name="l00332"></a>00332                         
<a name="l00333"></a>00333                 <span class="comment"># add the bias nodes</span>
<a name="l00334"></a>00334                 bias = -ones((shape(inputs)[0], 1))
<a name="l00335"></a>00335                 inputs = concatenate((inputs, bias), axis = 1)
<a name="l00336"></a>00336                 outputs = self.<a class="code" href="classmlp_1_1mlp.html#a50fab3d7313376cf2de90bcfc80db3a5" title="Run the network forward (internal function)">_mlpfwd</a>(inputs)
<a name="l00337"></a>00337                 <span class="keywordflow">return</span> outputs
<a name="l00338"></a>00338 
<a name="l00339"></a>00339 
<a name="l00340"></a>00340 
<a name="l00341"></a>00341         <span class="comment">##</span>
<a name="l00342"></a>00342         <span class="comment"># </span>
<a name="l00343"></a>00343         <span class="comment">#               Build confusion matrix</span>
<a name="l00344"></a>00344         <span class="comment"># </span>
<a name="l00345"></a>00345         <span class="comment">#               @param    inputs         Input values</span>
<a name="l00346"></a>00346         <span class="comment">#               @param    targets        Target values (known classification f.e.)</span>
<a name="l00347"></a>00347         <span class="comment">#               @param    makestats      True (default) if computing statistics for report</span>
<a name="l00348"></a>00348         <span class="comment">#               </span>
<a name="l00349"></a>00349         <span class="comment">#               @return:  cm             Confusion matrix</span>
<a name="l00350"></a>00350         <span class="comment">#               </span>
<a name="l00351"></a><a class="code" href="classmlp_1_1mlp.html#a809353450c250aa532e07119c4a731ee">00351</a>         <span class="keyword">def </span><a class="code" href="classmlp_1_1mlp.html#a809353450c250aa532e07119c4a731ee" title="Build confusion matrix.">confmat</a>(self, inputs, targets, makestats = True):
<a name="l00352"></a>00352 
<a name="l00353"></a>00353                 self.<a class="code" href="classmlp_1_1mlp.html#a60e5b36a360073418d45d221ff5c47f2">teststats</a> = <span class="keywordtype">None</span>
<a name="l00354"></a>00354                 <span class="keywordflow">if</span> (makestats == <span class="keyword">True</span>):
<a name="l00355"></a>00355                         self.<a class="code" href="classmlp_1_1mlp.html#a60e5b36a360073418d45d221ff5c47f2">teststats</a> = targets.sum(axis = 0)
<a name="l00356"></a>00356                         
<a name="l00357"></a>00357                 <span class="comment"># Add the inputs that match the bias node</span>
<a name="l00358"></a>00358                 inputs = concatenate((inputs, -ones((shape(inputs)[0], 1))), axis = 1)
<a name="l00359"></a>00359                 outputs = self.<a class="code" href="classmlp_1_1mlp.html#a50fab3d7313376cf2de90bcfc80db3a5" title="Run the network forward (internal function)">_mlpfwd</a>(inputs)
<a name="l00360"></a>00360 
<a name="l00361"></a>00361                 nclasses = shape(targets)[1]
<a name="l00362"></a>00362 
<a name="l00363"></a>00363                 <span class="keywordflow">if</span> nclasses == 1:
<a name="l00364"></a>00364                         nclasses = 2
<a name="l00365"></a>00365                         coutputs = where(outputs &gt; 0.5, 1, 0)
<a name="l00366"></a>00366                         ctargets = targets
<a name="l00367"></a>00367                 <span class="keywordflow">else</span>:
<a name="l00368"></a>00368                         <span class="keywordflow">if</span> (self.<a class="code" href="classmlp_1_1mlp.html#aa43f6dfd1707a355a974181d013e8f00">multires</a> == <span class="keyword">False</span>):
<a name="l00369"></a>00369                                 <span class="comment"># 1-of-N encoding</span>
<a name="l00370"></a>00370                                 coutputs = argmax(outputs, 1)
<a name="l00371"></a>00371                                 ctargets = argmax(targets, 1)
<a name="l00372"></a>00372                         <span class="keywordflow">else</span>:
<a name="l00373"></a>00373                                 coutputs = outputs
<a name="l00374"></a>00374                                 ctargets = targets
<a name="l00375"></a>00375 
<a name="l00376"></a>00376                 <span class="keywordflow">if</span> (self.<a class="code" href="classmlp_1_1mlp.html#aa43f6dfd1707a355a974181d013e8f00">multires</a> == <span class="keyword">False</span>):
<a name="l00377"></a>00377                         self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a> = zeros((nclasses, nclasses), dtype = int)
<a name="l00378"></a>00378                         <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(nclasses):
<a name="l00379"></a>00379                                 <span class="keywordflow">for</span> j <span class="keywordflow">in</span> range(nclasses):
<a name="l00380"></a>00380                                         <span class="comment"># a = where(coutputs == i, 1, 0)</span>
<a name="l00381"></a>00381                                         <span class="comment"># b = where(ctargets == j, 1, 0)</span>
<a name="l00382"></a>00382                                         <span class="comment"># c = a * b</span>
<a name="l00383"></a>00383                                         <span class="comment"># elem = sum(c)</span>
<a name="l00384"></a>00384                                         self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a>[i, j] = sum(where(coutputs == i, 1, 0) * 
<a name="l00385"></a>00385                                                                     where(ctargets == j, 1, 0))
<a name="l00386"></a>00386                         self.<a class="code" href="classmlp_1_1mlp.html#aab9e6c1e9b3661fa3f276d09baf27144">allpercent</a> = 1.0 * trace(self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a>) / sum(self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a>) * 100
<a name="l00387"></a>00387                 <span class="keywordflow">else</span>:
<a name="l00388"></a>00388                         self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a> = zeros((2, nclasses), dtype = int)
<a name="l00389"></a>00389                         diff = abs(ctargets - coutputs)
<a name="l00390"></a>00390                         success = where(diff &lt; self.<a class="code" href="classmlp_1_1mlp.html#a6a417dee0a55db5f56349db1249a3ec9">mdelta</a>, 1, 0)
<a name="l00391"></a>00391                         <span class="keywordflow">for</span> i <span class="keywordflow">in</span> xrange(nclasses):
<a name="l00392"></a>00392                                 self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a>[0, i] = sum(success[:, i])
<a name="l00393"></a>00393                                 self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a>[1, i] = sum(where(success[:, i] == 0, 1, 0))
<a name="l00394"></a>00394                         self.<a class="code" href="classmlp_1_1mlp.html#aab9e6c1e9b3661fa3f276d09baf27144">allpercent</a> = 1.0 * sum(self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a>[0]) / \
<a name="l00395"></a>00395                                                                         (nclasses * shape(targets)[0])
<a name="l00396"></a>00396                         
<a name="l00397"></a>00397 <span class="comment">#               print &quot;Confusion matrix is:&quot;</span>
<a name="l00398"></a>00398 <span class="comment">#               print self.cm</span>
<a name="l00399"></a>00399 <span class="comment">#               print &quot;Percentage Correct: &quot;, 1.0 * trace(self.cm) / sum(self.cm) * 100</span>
<a name="l00400"></a>00400 
<a name="l00401"></a>00401                 <span class="keywordflow">return</span> self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a>
<a name="l00402"></a>00402 
<a name="l00403"></a>00403 
<a name="l00404"></a>00404 
<a name="l00405"></a><a class="code" href="classmlp_1_1mlp.html#a6adedb6cd519479a5bdec3ca7b3e0c08">00405</a>         <span class="keyword">def </span><a class="code" href="classmlp_1_1mlp.html#a6adedb6cd519479a5bdec3ca7b3e0c08">_createreport</a>(self, classes, titlefmt, intfmt, floatfmt, firstcolfmt):
<a name="l00406"></a>00406                 olines = []
<a name="l00407"></a>00407                 <span class="comment"># nrclasses = len(classes)</span>
<a name="l00408"></a>00408                 
<a name="l00409"></a>00409                 olines.append(<span class="stringliteral">&#39;Input  nodes = %d&#39;</span> % self.<a class="code" href="classmlp_1_1mlp.html#a2769bdf0e5833e3999418868122feb28">nin</a>)
<a name="l00410"></a>00410                 olines.append(<span class="stringliteral">&#39;Hidden nodes = %d&#39;</span> % self.<a class="code" href="classmlp_1_1mlp.html#aa34217744fa9bc0bf1e8a3b358ed0c96">nhidden</a>)
<a name="l00411"></a>00411                 olines.append(<span class="stringliteral">&#39;Output nodes = %d, type = %s&#39;</span> % (self.<a class="code" href="classmlp_1_1mlp.html#a063008228bc8423626c2fa6e9a2664e9">nout</a>, self.<a class="code" href="classmlp_1_1mlp.html#ad85e6054d661877c130574e54434ce16">outtype</a>))
<a name="l00412"></a>00412                 olines.append(<span class="stringliteral">&#39;&#39;</span>)
<a name="l00413"></a>00413                 
<a name="l00414"></a>00414                 title = <span class="stringliteral">&#39;&#39;</span>
<a name="l00415"></a>00415                 <span class="keywordflow">for</span> i <span class="keywordflow">in</span> xrange(len(classes)):
<a name="l00416"></a>00416                         title += titlefmt % classes[i]
<a name="l00417"></a>00417                 <span class="keywordflow">if</span> ((self.<a class="code" href="classmlp_1_1mlp.html#adf2a63cd452121ea5e135c191dc5723d">trainstats</a> != <span class="keywordtype">None</span>) <span class="keywordflow">or</span> (self.<a class="code" href="classmlp_1_1mlp.html#a6ede6eef42e61e87fd2e79cf61529688">validstats</a> != <span class="keywordtype">None</span>) <span class="keywordflow">or</span>
<a name="l00418"></a>00418                          (self.<a class="code" href="classmlp_1_1mlp.html#a60e5b36a360073418d45d221ff5c47f2">teststats</a> != <span class="keywordtype">None</span>)):
<a name="l00419"></a>00419                         olines.append(<span class="stringliteral">&#39;Exemplars  &#39;</span> + title + <span class="stringliteral">&#39;    Sum&#39;</span>)
<a name="l00420"></a>00420 
<a name="l00421"></a>00421                 nrtrain = 0
<a name="l00422"></a>00422                 <span class="keywordflow">if</span> (self.<a class="code" href="classmlp_1_1mlp.html#adf2a63cd452121ea5e135c191dc5723d">trainstats</a> != <span class="keywordtype">None</span>):
<a name="l00423"></a>00423                         oline = <span class="stringliteral">&#39;Training   &#39;</span>
<a name="l00424"></a>00424                         <span class="keywordflow">for</span> i <span class="keywordflow">in</span> xrange(len(self.<a class="code" href="classmlp_1_1mlp.html#adf2a63cd452121ea5e135c191dc5723d">trainstats</a>)):
<a name="l00425"></a>00425                                 oline += intfmt % self.<a class="code" href="classmlp_1_1mlp.html#adf2a63cd452121ea5e135c191dc5723d">trainstats</a>[i]
<a name="l00426"></a>00426                         nrtrain = self.<a class="code" href="classmlp_1_1mlp.html#adf2a63cd452121ea5e135c191dc5723d">trainstats</a>.sum()
<a name="l00427"></a>00427                         oline += intfmt % nrtrain
<a name="l00428"></a>00428                         olines.append(oline)
<a name="l00429"></a>00429                 
<a name="l00430"></a>00430                 nrvalid = -1
<a name="l00431"></a>00431                 <span class="keywordflow">if</span> (self.<a class="code" href="classmlp_1_1mlp.html#a6ede6eef42e61e87fd2e79cf61529688">validstats</a> != <span class="keywordtype">None</span>):
<a name="l00432"></a>00432                         oline = <span class="stringliteral">&#39;Validation &#39;</span>
<a name="l00433"></a>00433                         <span class="keywordflow">for</span> i <span class="keywordflow">in</span> xrange(len(self.<a class="code" href="classmlp_1_1mlp.html#a6ede6eef42e61e87fd2e79cf61529688">validstats</a>)):
<a name="l00434"></a>00434                                 oline += intfmt % self.<a class="code" href="classmlp_1_1mlp.html#a6ede6eef42e61e87fd2e79cf61529688">validstats</a>[i]
<a name="l00435"></a>00435                         nrvalid = self.<a class="code" href="classmlp_1_1mlp.html#a6ede6eef42e61e87fd2e79cf61529688">validstats</a>.sum()
<a name="l00436"></a>00436                         oline += intfmt % nrvalid
<a name="l00437"></a>00437                         olines.append(oline)
<a name="l00438"></a>00438 
<a name="l00439"></a>00439                 nrtest = 0              
<a name="l00440"></a>00440                 <span class="keywordflow">if</span> (self.<a class="code" href="classmlp_1_1mlp.html#a60e5b36a360073418d45d221ff5c47f2">teststats</a> != <span class="keywordtype">None</span>):
<a name="l00441"></a>00441                         oline = <span class="stringliteral">&#39;Testing    &#39;</span>
<a name="l00442"></a>00442                         <span class="keywordflow">for</span> i <span class="keywordflow">in</span> xrange(len(self.<a class="code" href="classmlp_1_1mlp.html#a60e5b36a360073418d45d221ff5c47f2">teststats</a>)):
<a name="l00443"></a>00443                                 oline += intfmt % self.<a class="code" href="classmlp_1_1mlp.html#a60e5b36a360073418d45d221ff5c47f2">teststats</a>[i]
<a name="l00444"></a>00444                         nrtest = self.<a class="code" href="classmlp_1_1mlp.html#a60e5b36a360073418d45d221ff5c47f2">teststats</a>.sum()
<a name="l00445"></a>00445                         oline += intfmt % nrtest
<a name="l00446"></a>00446                         olines.append(oline)
<a name="l00447"></a>00447 
<a name="l00448"></a>00448                 olines.append(<span class="stringliteral">&#39;&#39;</span>)
<a name="l00449"></a>00449                 oline = <span class="stringliteral">&#39;Exemplars    = %d  (%d training, %d validating, %d testing)&#39;</span> % \
<a name="l00450"></a>00450                                 (nrtrain + nrvalid + nrtest, nrtrain, nrvalid, nrtest)
<a name="l00451"></a>00451                 olines.append(oline)
<a name="l00452"></a>00452                 
<a name="l00453"></a>00453                 olines.append(<span class="stringliteral">&#39;&#39;</span>)
<a name="l00454"></a>00454                 olines.append(<span class="stringliteral">&#39;momentum         = %f&#39;</span> % self.<a class="code" href="classmlp_1_1mlp.html#a3a4586ea27492667965ae101786a1fc8">momentum</a>)
<a name="l00455"></a>00455                 olines.append(<span class="stringliteral">&#39;beta             = %f&#39;</span> % self.<a class="code" href="classmlp_1_1mlp.html#a2f75a4b3429e0307568fc45d7e6950da">beta</a>)
<a name="l00456"></a>00456                 olines.append(<span class="stringliteral">&#39;learning rate    = %f&#39;</span> % self.<a class="code" href="classmlp_1_1mlp.html#a1b81b434ce0227f55d266dbb4c1e03a1">eta</a>)
<a name="l00457"></a>00457                 olines.append(<span class="stringliteral">&#39;nr iterations    = %d&#39;</span> % self.<a class="code" href="classmlp_1_1mlp.html#a79bb54ad6f2b84903e62c0b5f5eb7344">niterations</a>)
<a name="l00458"></a>00458                 olines.append(<span class="stringliteral">&#39;nr repetitions   = %s&#39;</span> % self.<a class="code" href="classmlp_1_1mlp.html#aa9d78571a75937654b1dbb2c78960aa1">stopcount</a>)
<a name="l00459"></a>00459                 olines.append(<span class="stringliteral">&#39;training error   = %.4f = %8f per exemplar&#39;</span> % \
<a name="l00460"></a>00460                       (self.<a class="code" href="classmlp_1_1mlp.html#a4e81b494e111fb2c72000efbaa647963">trainerror</a>, self.<a class="code" href="classmlp_1_1mlp.html#a4e81b494e111fb2c72000efbaa647963">trainerror</a> / self.<a class="code" href="classmlp_1_1mlp.html#a463f6e1b39fb817f6a302e522e591516">ndata</a>))
<a name="l00461"></a>00461                 olines.append(<span class="stringliteral">&#39;validation error = %.4f = %8f per exemplar&#39;</span> % \
<a name="l00462"></a>00462                                           (self.<a class="code" href="classmlp_1_1mlp.html#a778e5d4e1b507b330dcb6804455ac416">validerror</a>, self.<a class="code" href="classmlp_1_1mlp.html#a778e5d4e1b507b330dcb6804455ac416">validerror</a> / nrvalid))
<a name="l00463"></a>00463                 <span class="keywordflow">if</span> (self.<a class="code" href="classmlp_1_1mlp.html#aa43f6dfd1707a355a974181d013e8f00">multires</a> == <span class="keyword">True</span>):
<a name="l00464"></a>00464                         olines.append(<span class="stringliteral">&#39;delta for class. = %.4f&#39;</span> % self.<a class="code" href="classmlp_1_1mlp.html#a6a417dee0a55db5f56349db1249a3ec9">mdelta</a>)
<a name="l00465"></a>00465                 olines.append(<span class="stringliteral">&#39;&#39;</span>)
<a name="l00466"></a>00466                 
<a name="l00467"></a>00467                 <span class="keywordflow">if</span> (self.<a class="code" href="classmlp_1_1mlp.html#aa43f6dfd1707a355a974181d013e8f00">multires</a> == <span class="keyword">False</span>):
<a name="l00468"></a>00468                         oline = firstcolfmt % <span class="stringliteral">&quot;out/tar&quot;</span>
<a name="l00469"></a>00469                         olines.append(oline + title + titlefmt % <span class="stringliteral">&quot;% FAP&quot;</span>)
<a name="l00470"></a>00470                         <span class="keywordflow">for</span> i <span class="keywordflow">in</span> xrange(len(classes)):
<a name="l00471"></a>00471                                 oline = firstcolfmt % classes[i]
<a name="l00472"></a>00472                                 <span class="keywordflow">for</span> j <span class="keywordflow">in</span> xrange(len(classes)):
<a name="l00473"></a>00473                                         oline += intfmt % self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a>[i, j]
<a name="l00474"></a>00474                                 <span class="keywordflow">try</span>:
<a name="l00475"></a>00475                                         <span class="keywordflow">if</span> (self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a>[i].sum() == 0.0):
<a name="l00476"></a>00476                                                 oline += floatfmt % (0.0)
<a name="l00477"></a>00477                                         <span class="keywordflow">else</span>:
<a name="l00478"></a>00478                                                 oline += floatfmt % (100.0 - 100.0 * self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a>[i, i] / 
<a name="l00479"></a>00479                                                                                         self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a>[i].sum())
<a name="l00480"></a>00480                                 <span class="keywordflow">except</span> FloatingPointError <span class="keyword">as</span> err:
<a name="l00481"></a>00481                                         <span class="keywordflow">print</span> err, <span class="stringliteral">&#39; while printing diagonal element &#39;</span>, i
<a name="l00482"></a>00482                                         <span class="keywordflow">print</span> floatfmt
<a name="l00483"></a>00483                                         <span class="keywordflow">print</span> self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a>[i, i]
<a name="l00484"></a>00484                                         <span class="keywordflow">print</span> self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a>[i].sum()
<a name="l00485"></a>00485                                 olines.append(oline)
<a name="l00486"></a>00486                         tmp = self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a>.sum(axis = 0)
<a name="l00487"></a>00487                         olines.append(<span class="stringliteral">&#39;&#39;</span>)
<a name="l00488"></a>00488                         oline = firstcolfmt % <span class="stringliteral">&#39;Sum&#39;</span>
<a name="l00489"></a>00489                         <span class="keywordflow">for</span> i <span class="keywordflow">in</span> xrange(len(tmp)):
<a name="l00490"></a>00490                                 oline += intfmt % tmp[i]
<a name="l00491"></a>00491                         olines.append(oline)
<a name="l00492"></a>00492                         oline = firstcolfmt % <span class="stringliteral">&#39;% corr&#39;</span>
<a name="l00493"></a>00493                         <span class="keywordflow">for</span> i <span class="keywordflow">in</span> xrange(shape(self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a>)[1]):
<a name="l00494"></a>00494                                 <span class="keywordflow">try</span>:
<a name="l00495"></a>00495                                         <span class="keywordflow">if</span> (tmp[i] == 0.0):
<a name="l00496"></a>00496                                                 oline += floatfmt % (0.0)
<a name="l00497"></a>00497                                         <span class="keywordflow">else</span>:
<a name="l00498"></a>00498                                                 oline += floatfmt % (100.0 * self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a>[i,i] / tmp[i])
<a name="l00499"></a>00499                                 <span class="keywordflow">except</span> FloatingPointError <span class="keyword">as</span> err:
<a name="l00500"></a>00500                                         <span class="keywordflow">print</span> err, <span class="stringliteral">&#39; while printing FAP &#39;</span>, i
<a name="l00501"></a>00501                                         <span class="keywordflow">print</span> floatfmt
<a name="l00502"></a>00502                                         <span class="keywordflow">print</span> self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a>[i, i]
<a name="l00503"></a>00503                                         <span class="keywordflow">print</span> tmp[i]
<a name="l00504"></a>00504                         olines.append(oline)
<a name="l00505"></a>00505                 <span class="keywordflow">else</span>:
<a name="l00506"></a>00506                         testcases = sum(self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a>)
<a name="l00507"></a>00507                         oline = firstcolfmt % <span class="stringliteral">&#39;classes&#39;</span>
<a name="l00508"></a>00508                         olines.append(oline + title + titlefmt % <span class="stringliteral">&quot;  %  &quot;</span>)
<a name="l00509"></a>00509                         oline = firstcolfmt % <span class="stringliteral">&#39;&lt; delta&#39;</span>
<a name="l00510"></a>00510                         <span class="keywordflow">for</span> i <span class="keywordflow">in</span> xrange(len(classes)):
<a name="l00511"></a>00511                                 oline += intfmt % self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a>[0, i]
<a name="l00512"></a>00512                         oline += floatfmt % (100.0 * sum(self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a>[0]) / testcases)
<a name="l00513"></a>00513                         olines.append(oline)
<a name="l00514"></a>00514                         oline = firstcolfmt % <span class="stringliteral">&#39;&gt; delta&#39;</span>
<a name="l00515"></a>00515                         <span class="keywordflow">for</span> i <span class="keywordflow">in</span> xrange(len(classes)):
<a name="l00516"></a>00516                                 oline += intfmt % self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a>[1, i]
<a name="l00517"></a>00517                         oline += floatfmt % (100.0 * sum(self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a>[1]) / testcases)
<a name="l00518"></a>00518                         olines.append(oline)
<a name="l00519"></a>00519                         olines.append(<span class="stringliteral">&#39;&#39;</span>)
<a name="l00520"></a>00520                         tmp = self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a>.sum(axis = 0)
<a name="l00521"></a>00521                         oline = firstcolfmt % <span class="stringliteral">&#39;Sum&#39;</span>
<a name="l00522"></a>00522                         <span class="keywordflow">for</span> i <span class="keywordflow">in</span> xrange(len(tmp)):
<a name="l00523"></a>00523                                 oline += intfmt % tmp[i]
<a name="l00524"></a>00524                         olines.append(oline)
<a name="l00525"></a>00525                         oline = firstcolfmt % <span class="stringliteral">&#39;% corr&#39;</span>
<a name="l00526"></a>00526                         <span class="keywordflow">for</span> i <span class="keywordflow">in</span> xrange(shape(self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a>)[1]):
<a name="l00527"></a>00527                                 oline += floatfmt % (100.0 * self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a>[0,i] / tmp[i])
<a name="l00528"></a>00528                         olines.append(oline)
<a name="l00529"></a>00529                 
<a name="l00530"></a>00530                 olines.append(<span class="stringliteral">&#39;&#39;</span>)
<a name="l00531"></a>00531                 oline = <span class="stringliteral">&#39;Number of testcases = %4d&#39;</span> % self.<a class="code" href="classmlp_1_1mlp.html#a0573cbd708236e8af5fb46edc9c36660">cm</a>.sum()
<a name="l00532"></a>00532                 olines.append(oline)
<a name="l00533"></a>00533                 <span class="comment"># self.allpercent = 100.0 * trace(self.cm) / sum(self.cm)</span>
<a name="l00534"></a>00534                 oline = <span class="stringliteral">&quot;Percentage correct  = %6.2f&quot;</span> % (self.<a class="code" href="classmlp_1_1mlp.html#aab9e6c1e9b3661fa3f276d09baf27144">allpercent</a>)
<a name="l00535"></a>00535                 olines.append(oline)
<a name="l00536"></a>00536 
<a name="l00537"></a>00537                 <span class="keywordflow">return</span> olines
<a name="l00538"></a>00538 
<a name="l00539"></a>00539 
<a name="l00540"></a>00540 
<a name="l00541"></a>00541         <span class="comment">##</span>
<a name="l00542"></a>00542         <span class="comment"># </span>
<a name="l00543"></a>00543         <span class="comment">#               Print or write report of training or evaluation of inputs</span>
<a name="l00544"></a>00544         <span class="comment">#               </span>
<a name="l00545"></a>00545         <span class="comment">#               @param titlefmt: Format string for class titles</span>
<a name="l00546"></a>00546         <span class="comment">#               @param intfmt:   Format string for integer values</span>
<a name="l00547"></a>00547         <span class="comment">#               @param floatfmt: Format string for floating point values</span>
<a name="l00548"></a>00548         <span class="comment">#               @param classes:  string with class-names (None = default = use self.classes)</span>
<a name="l00549"></a>00549         <span class="comment">#               @param ofname:   name of output file (default = None)</span>
<a name="l00550"></a>00550         <span class="comment">#               @param firstcolfmt: Format for first columns (classes, default &quot;%7s&quot;)</span>
<a name="l00551"></a>00551         <span class="comment">#               </span>
<a name="l00552"></a><a class="code" href="classmlp_1_1mlp.html#ad5d52821223492fb389df89622053965">00552</a>         <span class="keyword">def </span><a class="code" href="classmlp_1_1mlp.html#ad5d52821223492fb389df89622053965" title="Print or write report of training or evaluation of inputs.">report</a>(self, titlefmt, intfmt, floatfmt, classes = None, ofname = None,
<a name="l00553"></a>00553                             firstcolfmt = <span class="stringliteral">&#39;%7s &#39;</span>):
<a name="l00554"></a>00554                 
<a name="l00555"></a>00555                 <span class="keywordflow">if</span> (classes != <span class="keywordtype">None</span>):
<a name="l00556"></a>00556                         self.<a class="code" href="classmlp_1_1mlp.html#ae97e72b20c044203c2a86adc234eb9c5">classes</a> = classes
<a name="l00557"></a>00557                 olines = self.<a class="code" href="classmlp_1_1mlp.html#a6adedb6cd519479a5bdec3ca7b3e0c08">_createreport</a>(self.<a class="code" href="classmlp_1_1mlp.html#ae97e72b20c044203c2a86adc234eb9c5">classes</a>, titlefmt, intfmt, floatfmt,
<a name="l00558"></a>00558                                                                     firstcolfmt)
<a name="l00559"></a>00559                 
<a name="l00560"></a>00560                 <span class="keywordflow">if</span> (ofname == <span class="keywordtype">None</span>):
<a name="l00561"></a>00561                         <span class="keywordflow">for</span> line <span class="keywordflow">in</span> olines:
<a name="l00562"></a>00562                                 <span class="keywordflow">print</span> line
<a name="l00563"></a>00563                 <span class="keywordflow">else</span>:
<a name="l00564"></a>00564                         of = open(self.<a class="code" href="classmlp_1_1mlp.html#ad29044bad5109b92f57149d8bec68e14">subdir</a> + <span class="stringliteral">&#39;/&#39;</span> + ofname, <span class="stringliteral">&#39;w&#39;</span>)
<a name="l00565"></a>00565                         <span class="keywordflow">for</span> line <span class="keywordflow">in</span> olines:
<a name="l00566"></a>00566                                 of.write(line + <span class="stringliteral">&#39;\n&#39;</span>)
<a name="l00567"></a>00567                         of.close()
<a name="l00568"></a>00568 
</pre></div></div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
